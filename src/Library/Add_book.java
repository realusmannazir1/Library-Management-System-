package Library;



import java.sql.*;
import javax.swing.*;
import javax.swing.filechooser.FileNameExtensionFilter;
import java.awt.*;
import java.io.*;







/**
 *
 * @author Zakir
 */
public class Add_book extends javax.swing.JFrame {

    /**
     * Creates new form add_member
     */
     
    public Add_book() {
        initComponents();
         
    }
    

    


    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel2 = new javax.swing.JPanel();
        upload = new javax.swing.JButton();
        aouthor_field = new javax.swing.JTextField();
        jLabel7 = new javax.swing.JLabel();
        jLabel11 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        jButton1 = new javax.swing.JButton();
        edition_field = new javax.swing.JTextField();
        quantity_field = new javax.swing.JFormattedTextField();
        name_field = new javax.swing.JTextField();
        jLabel5 = new javax.swing.JLabel();
        main_label = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setTitle("ADD BOOK");
        setResizable(false);
        getContentPane().setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        jPanel2.setBackground(new java.awt.Color(0, 0, 0,0));
        jPanel2.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        upload.setBackground(new java.awt.Color(0, 102, 255));
        upload.setFont(new java.awt.Font("Segoe UI Black", 1, 14)); // NOI18N
        upload.setForeground(new java.awt.Color(255, 255, 255));
        upload.setText("Upload ");
        upload.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));
        upload.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                uploadActionPerformed(evt);
            }
        });
        jPanel2.add(upload, new org.netbeans.lib.awtextra.AbsoluteConstraints(370, 70, 110, 40));

        aouthor_field.setBackground(new java.awt.Color(102, 102, 102));
        aouthor_field.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        aouthor_field.setForeground(new java.awt.Color(255, 255, 255));
        aouthor_field.setBorder(new javax.swing.border.LineBorder(new java.awt.Color(255, 255, 255), 3, true));
        jPanel2.add(aouthor_field, new org.netbeans.lib.awtextra.AbsoluteConstraints(260, 280, 230, 30));

        jLabel7.setBackground(new java.awt.Color(0,0,0,0));
        jLabel7.setFont(new java.awt.Font("Microsoft YaHei UI", 1, 18)); // NOI18N
        jLabel7.setForeground(new java.awt.Color(255, 255, 255));
        jLabel7.setText("Edition");
        jLabel7.setOpaque(true);
        jPanel2.add(jLabel7, new org.netbeans.lib.awtextra.AbsoluteConstraints(120, 340, 130, 30));

        jLabel11.setBackground(new java.awt.Color(0,0,0,0));
        jLabel11.setFont(new java.awt.Font("Microsoft YaHei UI", 1, 18)); // NOI18N
        jLabel11.setForeground(new java.awt.Color(255, 255, 255));
        jLabel11.setText("Quantity");
        jLabel11.setOpaque(true);
        jPanel2.add(jLabel11, new org.netbeans.lib.awtextra.AbsoluteConstraints(120, 400, 120, 30));

        jLabel3.setBackground(new java.awt.Color(0,0,0,0));
        jLabel3.setFont(new java.awt.Font("Microsoft YaHei UI", 1, 18)); // NOI18N
        jLabel3.setForeground(new java.awt.Color(255, 255, 255));
        jLabel3.setText("Book name");
        jLabel3.setOpaque(true);
        jPanel2.add(jLabel3, new org.netbeans.lib.awtextra.AbsoluteConstraints(120, 220, 120, 30));

        jButton1.setBackground(new java.awt.Color(102, 153, 255));
        jButton1.setFont(new java.awt.Font("Segoe UI Black", 1, 24)); // NOI18N
        jButton1.setText("ADD");
        jButton1.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));
        jButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });
        jPanel2.add(jButton1, new org.netbeans.lib.awtextra.AbsoluteConstraints(230, 490, 140, 60));

        edition_field.setBackground(new java.awt.Color(102, 102, 102));
        edition_field.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        edition_field.setForeground(new java.awt.Color(255, 255, 255));
        edition_field.setBorder(new javax.swing.border.LineBorder(new java.awt.Color(255, 255, 255), 3, true));
        jPanel2.add(edition_field, new org.netbeans.lib.awtextra.AbsoluteConstraints(260, 340, 230, 30));

        quantity_field.setBackground(new java.awt.Color(102, 102, 102));
        quantity_field.setForeground(new java.awt.Color(255, 255, 255));
        try {
            quantity_field.setFormatterFactory(new javax.swing.text.DefaultFormatterFactory(new javax.swing.text.MaskFormatter("###")));
        } catch (java.text.ParseException ex) {
            ex.printStackTrace();
        }
        quantity_field.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                quantity_fieldActionPerformed(evt);
            }
        });
        jPanel2.add(quantity_field, new org.netbeans.lib.awtextra.AbsoluteConstraints(260, 400, 230, 30));

        name_field.setBackground(new java.awt.Color(102, 102, 102));
        name_field.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        name_field.setForeground(new java.awt.Color(255, 255, 255));
        name_field.setBorder(new javax.swing.border.LineBorder(new java.awt.Color(255, 255, 255), 3, true));
        name_field.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                name_fieldActionPerformed(evt);
            }
        });
        jPanel2.add(name_field, new org.netbeans.lib.awtextra.AbsoluteConstraints(260, 220, 230, 30));

        jLabel5.setBackground(new java.awt.Color(0,0,0,0));
        jLabel5.setFont(new java.awt.Font("Microsoft YaHei UI", 1, 18)); // NOI18N
        jLabel5.setForeground(new java.awt.Color(255, 255, 255));
        jLabel5.setText("Aouther name");
        jLabel5.setOpaque(true);
        jPanel2.add(jLabel5, new org.netbeans.lib.awtextra.AbsoluteConstraints(120, 280, 130, 30));

        getContentPane().add(jPanel2, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 570, 610));

        main_label.setBackground(new java.awt.Color(0, 3, 5,140));
        main_label.setOpaque(true);
        getContentPane().add(main_label, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 570, 610));

        pack();
    }// </editor-fold>//GEN-END:initComponents

    
      
    
    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed

        add();

    }

 private void clearFields() {
        name_field.setText("");
        aouthor_field.setText("");
        edition_field.setText("");
        quantity_field.setText("");
        
        }

        
        public static void main(String args[]) {
    java.awt.EventQueue.invokeLater(() -> {
        new Add_book().setVisible(true); // <-- 'this' reference error
    });


    }//GEN-LAST:event_jButton1ActionPerformed

    private void quantity_fieldActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_quantity_fieldActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_quantity_fieldActionPerformed

    private void name_fieldActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_name_fieldActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_name_fieldActionPerformed
byte[] imageBytes = null;
    private void uploadActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_uploadActionPerformed
        JFileChooser fileChooser = new JFileChooser();
        FileNameExtensionFilter filter = new FileNameExtensionFilter(
            "Image Files", "jpg", "jpeg", "png", "gif");

        fileChooser.setFileFilter(filter);

        int result = fileChooser.showOpenDialog(null);

        if (result == JFileChooser.APPROVE_OPTION) {
            var selectedFile = fileChooser.getSelectedFile();
            ImageIcon icon = new ImageIcon(selectedFile.getAbsolutePath());

            /*  // Resize image to fit the label
            Image img;
            img = icon.getImage().getScaledInstance(
            lable.getWidth(), lable.getHeight(), Image.SCALE_SMOOTH);
            lable.setIcon(new ImageIcon(img));*/

            // Convert the selected image to a byte array for storage in database

            try {
                byte[] ImageBytes = null;
                try (FileInputStream fis = new FileInputStream(selectedFile)) {
                    ImageBytes = fis.readAllBytes();
                }
            } catch (IOException e) {
            }

         
        }

    }//GEN-LAST:event_uploadActionPerformed








    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JTextField aouthor_field;
    private javax.swing.JTextField edition_field;
    private javax.swing.JButton jButton1;
    private javax.swing.JLabel jLabel11;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JLabel main_label;
    private javax.swing.JTextField name_field;
    private javax.swing.JFormattedTextField quantity_field;
    private javax.swing.JButton upload;
    // End of variables declaration//GEN-END:variables

    
    
void add() {
    
    String bookName = name_field.getText().trim();
    String author = aouthor_field.getText().trim();
    String edition = edition_field.getText().trim();
    String quantity = quantity_field.getText().trim();

    if ( bookName.isEmpty() || author.isEmpty() || edition.isEmpty() || quantity.isEmpty()) {
        JOptionPane.showMessageDialog(this, "Please fill all fields.");
        return;
    }

   ConnectionTest zak = new ConnectionTest();
   
     String url=zak.url;
     String user=zak.user;
     String passs=zak.password;
    String detailsQuery = "insert into books (book_name , author , edition, quantity,profile_pic) values(?,?,?,?,?)";
    try (Connection con = DriverManager.getConnection(url, user, passs)) {
        PreparedStatement pst = con.prepareStatement(detailsQuery);
        pst.setString(1, bookName);
        pst.setString(2, author);
        pst.setString(3, edition);
        pst.setString(4, quantity);
         pst.setBytes(5, imageBytes);
       
        int row = pst.executeUpdate();
        
        if (row > 0) {
            JOptionPane.showMessageDialog(this, "Book added successfully!");
        } else {
            JOptionPane.showMessageDialog(this, "Book not found or update failed.");
            return;
        }

        clearFields();
        

    } catch (Exception e) {
        JOptionPane.showMessageDialog(this, "Database Error: " + e.getMessage());
    }
}

    private static class lable {

        private static void setIcon(@SuppressWarnings("unused") ImageIcon imageIcon) {
            throw new UnsupportedOperationException("Not supported yet."); // Generated from nbfs://nbhost/SystemFileSystem/Templates/Classes/Code/GeneratedMethodBody
        }




        public lable() {
        }
    }
     

    
}

